#include <stdio.h>
#include <math.h>
#include "../fmt.h"
#include "../str.h"

struct fmt_test {
  unsigned int sig;
  unsigned int len;
  float num;
  char *str;
};

static const struct fmt_test tests[] = {
  /* zero tests */
  { 0, 0, 0.0, "" },
  { 1, 3, 0.0, "0.0" },
  { 2, 4, 0.0, "0.00" },
  { 3, 5, 0.0, "0.000" },
  { 4, 6, 0.0, "0.0000" },
  { 5, 7, 0.0, "0.00000" },
  { 6, 8, 0.0, "0.000000" },

  /* negative zero tests */
  { 0, 0, -0.0, "" },
  { 1, 4, -0.0, "-0.0" },
  { 2, 5, -0.0, "-0.00" },
  { 3, 6, -0.0, "-0.000" },
  { 4, 7, -0.0, "-0.0000" },
  { 5, 8, -0.0, "-0.00000" },
  { 6, 9, -0.0, "-0.000000" },

  /* integral */
  { 0, 0, 123456.0, "" },
  { 1, 8, 123456.0, "123456.0" },
  { 2, 9, 123456.0, "123456.00" },
  { 3, 10, 123456.0, "123456.000" },
  { 4, 11, 123456.0, "123456.0000" },
  { 5, 12, 123456.0, "123456.00000" },
  { 6, 13, 123456.0, "123456.000000" },

  /* fractional */
  { 0, 0, 0.123456, "" },
  { 1, 3, 0.123456, "0.1" },
  { 2, 4, 0.123456, "0.12" },
  { 3, 5, 0.123456, "0.123" },
  { 4, 6, 0.123456, "0.1235" },
  { 5, 7, 0.123456, "0.12346" },
  { 6, 8, 0.123456, "0.123456" },

  /* negative integral */
  { 0, 0, -123456.0, "" },
  { 1, 9, -123456.0, "-123456.0" },
  { 2, 10, -123456.0, "-123456.00" },
  { 3, 11, -123456.0, "-123456.000" },
  { 4, 12, -123456.0, "-123456.0000" },
  { 5, 13, -123456.0, "-123456.00000" },
  { 6, 14, -123456.0, "-123456.000000" },

  /* negative fractional */
  { 0, 0, -0.123456, "" },
  { 1, 4, -0.123456, "-0.1" },
  { 2, 5, -0.123456, "-0.12" },
  { 3, 6, -0.123456, "-0.123" },
  { 4, 7, -0.123456, "-0.1235" },
  { 5, 8, -0.123456, "-0.12346" },
  { 6, 9, -0.123456, "-0.123456" },

  /* large */
  { 0, 0, 1234567.9876543, "" },
  { 1, 5, 1234567.9876543, "1.2e6" },
  { 2, 6, 1234567.9876543, "1.23e6" },
  { 3, 7, 1234567.9876543, "1.235e6" },
  { 4, 8, 1234567.9876543, "1.2346e6" },
  { 5, 9, 1234567.9876543, "1.23457e6" },
  { 6, 10, 1234567.9876543, "1.234568e6" },

  /* negative large */
  { 0, 0, -1234567.9876543, "" },
  { 1, 6, -1234567.9876543, "-1.2e6" },
  { 2, 7, -1234567.9876543, "-1.23e6" },
  { 3, 8, -1234567.9876543, "-1.235e6" },
  { 4, 9, -1234567.9876543, "-1.2346e6" },
  { 5, 10, -1234567.9876543, "-1.23457e6" },
  { 6, 11, -1234567.9876543, "-1.234568e6" },

  /* FLT_MAX, FLT_MIN */
  { 6, 11, 1e37, "9.999998e36" },
  { 5, 11, 1e37, "9.999910e36" },
  { 4, 10, 1e37, "9.99910e36" },
  { 3, 9, 1e37, "9.9910e36" },
  { 2, 8, 1e37, "9.910e36" },
  { 1, 7, 1e37, "9.10e36" },
  { 6, 12, 1e-37, "9.999999e-38" },
  { 5, 12, 1e-37, "9.999910e-38" },
  { 4, 11, 1e-37, "9.99910e-38" },
  { 3, 10, 1e-37, "9.9910e-38" },
  { 2, 9, 1e-37, "9.910e-38" },
  { 1, 8, 1e-37, "9.10e-38" },

  /* t_scan_doub */
  { 6, 9, 1e1, "10.000000" },
  { 5, 8, 1e1, "10.00000" },
  { 4, 7, 1e1, "10.0000" },
  { 3, 6, 1e1, "10.000" },
  { 2, 5, 1e1, "10.00" },
  { 1, 4, 1e1, "10.0" },

  { 6, 8, 1e-1, "0.100000" },
  { 5, 7, 1e-1, "0.10000" },
  { 4, 6, 1e-1, "0.1000" },
  { 3, 5, 1e-1, "0.100" },
  { 2, 4, 1e-1, "0.10" },
  { 1, 3, 1e-1, "0.1" },

  { 6, 11, 1e10, "1.000000e10" },
  { 5, 10, 1e10, "1.00000e10" },
  { 4, 9, 1e10, "1.0000e10" },
  { 3, 8, 1e10, "1.000e10" },
  { 2, 7, 1e10, "1.00e10" },
  { 1, 6, 1e10, "1.0e10" },

  { 6, 12, 1e-10, "9.999999e-11" },
  { 5, 12, 1e-10, "9.999910e-11" },
  { 4, 11, 1e-10, "9.99910e-11" },
  { 3, 10, 1e-10, "9.9910e-11" },
  { 2, 9, 1e-10, "9.910e-11" },
  { 1, 8, 1e-10, "9.10e-11" },

  { 6, 10, -1e1, "-10.000000" },
  { 5, 9, -1e1, "-10.00000" },
  { 4, 8, -1e1, "-10.0000" },
  { 3, 7, -1e1, "-10.000" },
  { 2, 6, -1e1, "-10.00" },
  { 1, 5, -1e1, "-10.0" },

  { 6, 9, -1e-1, "-0.100000" },
  { 5, 8, -1e-1, "-0.10000" },
  { 4, 7, -1e-1, "-0.1000" },
  { 3, 6, -1e-1, "-0.100" },
  { 2, 5, -1e-1, "-0.10" },
  { 1, 4, -1e-1, "-0.1" },

  { 6, 12, -1e10, "-1.000000e10" },
  { 5, 11, -1e10, "-1.00000e10" },
  { 4, 10, -1e10, "-1.0000e10" },
  { 3, 9, -1e10, "-1.000e10" },
  { 2, 8, -1e10, "-1.00e10" },
  { 1, 7, -1e10, "-1.0e10" },

  { 6, 13, -1e-10, "-9.999999e-11" },
  { 5, 13, -1e-10, "-9.999910e-11" },
  { 4, 12, -1e-10, "-9.99910e-11" },
  { 3, 11, -1e-10, "-9.9910e-11" },
  { 2, 10, -1e-10, "-9.910e-11" },
  { 1, 9, -1e-10, "-9.10e-11" },

  { 6, 9, 1.0e1, "10.000000" },
  { 5, 8, 1.0e1, "10.00000" },
  { 4, 7, 1.0e1, "10.0000" },
  { 3, 6, 1.0e1, "10.000" },
  { 2, 5, 1.0e1, "10.00" },
  { 1, 4, 1.0e1, "10.0" },

  { 6, 8, 1.0e-1, "0.100000" },
  { 5, 7, 1.0e-1, "0.10000" },
  { 4, 6, 1.0e-1, "0.1000" },
  { 3, 5, 1.0e-1, "0.100" },
  { 2, 4, 1.0e-1, "0.10" },
  { 1, 3, 1.0e-1, "0.1" },

  { 6, 9, 1.0e-2, "0.0099910" },
  { 5, 8, 1.0e-2, "0.009910" },
  { 4, 7, 1.0e-2, "0.00910" },
  { 3, 6, 1.0e-2, "0.0010" },
  { 2, 4, 1.0e-2, "0.01" },
  { 1, 3, 1.0e-2, "0.0" },

  { 6, 11, 1.0e10, "1.000000e10" },
  { 5, 10, 1.0e10, "1.00000e10" },
  { 4, 9, 1.0e10, "1.0000e10" },
  { 3, 8, 1.0e10, "1.000e10" },
  { 2, 7, 1.0e10, "1.00e10" },
  { 1, 6, 1.0e10, "1.0e10" },

  { 6, 12, 1.0e-10, "9.999999e-11" },
  { 5, 12, 1.0e-10, "9.999910e-11" },
  { 4, 11, 1.0e-10, "9.99910e-11" },
  { 3, 10, 1.0e-10, "9.9910e-11" },
  { 2, 9, 1.0e-10, "9.910e-11" },
  { 1, 8, 1.0e-10, "9.10e-11" },

  { 6, 10, -1.0e1, "-10.000000" },
  { 5, 9, -1.0e1, "-10.00000" },
  { 4, 8, -1.0e1, "-10.0000" },
  { 3, 7, -1.0e1, "-10.000" },
  { 2, 6, -1.0e1, "-10.00" },
  { 1, 5, -1.0e1, "-10.0" },

  { 6, 9, -1.0e-1, "-0.100000" },
  { 5, 8, -1.0e-1, "-0.10000" },
  { 4, 7, -1.0e-1, "-0.1000" },
  { 3, 6, -1.0e-1, "-0.100" },
  { 2, 5, -1.0e-1, "-0.10" },
  { 1, 4, -1.0e-1, "-0.1" },

  { 6, 12, -1.0e10, "-1.000000e10" },
  { 5, 11, -1.0e10, "-1.00000e10" },
  { 4, 10, -1.0e10, "-1.0000e10" },
  { 3, 9, -1.0e10, "-1.000e10" },
  { 2, 8, -1.0e10, "-1.00e10" },
  { 1, 7, -1.0e10, "-1.0e10" },

  { 6, 13, -1.0e-10, "-9.999999e-11" },
  { 5, 13, -1.0e-10, "-9.999910e-11" },
  { 4, 12, -1.0e-10, "-9.99910e-11" },
  { 3, 11, -1.0e-10, "-9.9910e-11" },
  { 2, 10, -1.0e-10, "-9.910e-11" },
  { 1, 9, -1.0e-10, "-9.10e-11" },

  { 6, 8, 0.1, "0.100000" },
  { 5, 7, 0.1, "0.10000" },
  { 4, 6, 0.1, "0.1000" },
  { 3, 5, 0.1, "0.100" },
  { 2, 4, 0.1, "0.10" },
  { 1, 3, 0.1, "0.1" },

  { 6, 9, 0.01, "0.0099910" },
  { 5, 8, 0.01, "0.009910" },
  { 4, 7, 0.01, "0.00910" },
  { 3, 6, 0.01, "0.0010" },
  { 2, 4, 0.01, "0.01" },
  { 1, 3, 0.01, "0.0" },

  { 6, 8, 0.001, "0.001000" },
  { 5, 7, 0.001, "0.00100" },
  { 4, 6, 0.001, "0.0010" },
  { 3, 5, 0.001, "0.001" },
  { 2, 4, 0.001, "0.00" },
  { 1, 3, 0.001, "0.0" },

  { 6, 9, 0.0001, "0.0000910" },
  { 5, 8, 0.0001, "0.000010" },
  { 4, 6, 0.0001, "0.0001" },
  { 3, 5, 0.0001, "0.000" },
  { 2, 4, 0.0001, "0.00" },
  { 1, 3, 0.0001, "0.0" },

  { 6, 11, 0.00001, "9.999999e-6" },
  { 5, 11, 0.00001, "9.999910e-6" },
  { 4, 10, 0.00001, "9.99910e-6" },
  { 3, 9, 0.00001, "9.9910e-6" },
  { 2, 8, 0.00001, "9.910e-6" },
  { 1, 7, 0.00001, "9.10e-6" },

  { 6, 11, 0.000001, "9.999999e-7" },
  { 5, 11, 0.000001, "9.999910e-7" },
  { 4, 10, 0.000001, "9.99910e-7" },
  { 3, 9, 0.000001, "9.9910e-7" },
  { 2, 8, 0.000001, "9.910e-7" },
  { 1, 7, 0.000001, "9.10e-7" },

  { 6, 11, 0.0000001, "9.999999e-8" },
  { 5, 11, 0.0000001, "9.999910e-8" },
  { 4, 10, 0.0000001, "9.99910e-8" },
  { 3, 9, 0.0000001, "9.9910e-8" },
  { 2, 8, 0.0000001, "9.910e-8" },
  { 1, 7, 0.0000001, "9.10e-8" },

  { 6, 11, 0.00000001, "9.999999e-9" },
  { 5, 11, 0.00000001, "9.999910e-9" },
  { 4, 10, 0.00000001, "9.99910e-9" },
  { 3, 9, 0.00000001, "9.9910e-9" },
  { 2, 8, 0.00000001, "9.910e-9" },
  { 1, 7, 0.00000001, "9.10e-9" },
};

int main(void)
{
  char cnum[FMT_FLOAT];
  unsigned int ind;
  unsigned int len;

  for (ind = 0; ind < sizeof(tests) / sizeof(struct fmt_test); ++ind) {
    len = fmt_float(cnum, tests[ind].num, tests[ind].sig);
    if (len != tests[ind].len) {
      printf("[%u] fail: len %u != %u %s %s\n", ind, len, tests[ind].len, cnum, tests[ind].str);
      return 1;
    }
    len = fmt_float(FMT_LEN, tests[ind].num, tests[ind].sig);
    if (len != tests[ind].len) {
      printf("[%u] fail: FMT_LEN len %u != %u\n", ind, len, tests[ind].len);
      return 1;
    }
    cnum[len] = 0;
    if (!str_same(cnum, tests[ind].str)) {
      printf("[%u] fail: %s != %s\n", ind, cnum, tests[ind].str);
      return 1;
    }
    printf("[%u] pass: %s == %s\n", ind, tests[ind].str, cnum);
  }

  return 0;
}
